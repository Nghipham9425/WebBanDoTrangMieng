@{
    ViewBag.Title = "Giỏ hàng";
}

<div class="container py-5">
    <h1 class="mb-4 fw-bold text-success">Giỏ hàng của bạn</h1>
    <div class="row">
        <div class="col-lg-8 mb-4 mb-lg-0">
            <div class="card shadow-sm">
                <div class="card-header bg-light border-bottom-0 rounded-top">
                    <div class="row fw-semibold text-success">
                        <div class="col-5">Sản phẩm</div>
                        <div class="col-2 text-end">Đơn giá</div>
                        <div class="col-3 text-center">Số lượng</div>
                        <div class="col-2"></div>
                    </div>
                </div>
                <div class="list-group list-group-flush">
                    <!-- Sản phẩm 1 -->
                    <div class="list-group-item px-0 border-0">
                        <div class="row align-items-center" style="min-height: 70px;">
                            <div class="col-5 d-flex align-items-center">
                                <img src="https://images.unsplash.com/photo-1587314168485-3236d6710814?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" alt="Bánh Mousse Matcha" class="rounded me-3 flex-shrink-0" style="width: 60px; height: 60px; object-fit: cover; background: #f8f8f8;">
                                <span class="fw-semibold text-success text-truncate" style="max-width: 120px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Bánh Mousse Matcha</span>
                            </div>
                            <div class="col-2 text-success fw-bold text-end">75.000đ</div>
                            <div class="col-3 d-flex justify-content-center align-items-center">
                                <div class="input-group input-group-sm w-auto" style="vertical-align: middle; margin: 0;">
                                    <button class="btn btn-outline-success btn-sm decrease d-flex align-items-center justify-content-center" type="button" style="width: 32px; height: 32px; padding: 0;">-</button>
                                    <input type="text" class="form-control text-center quantity-input" value="1" min="1" readonly style="width: 40px; height: 32px; line-height: 32px; padding: 0;">
                                    <button class="btn btn-outline-success btn-sm increase d-flex align-items-center justify-content-center" type="button" style="width: 32px; height: 32px; padding: 0;">+</button>
                                </div>
                            </div>
                            <div class="col-2 d-flex justify-content-center">
                                <button class="btn btn-link text-danger remove-btn p-0" title="Xóa sản phẩm">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- Sản phẩm 2 -->
                    <div class="list-group-item px-0 border-0">
                        <div class="row align-items-center" style="min-height: 70px;">
                            <div class="col-5 d-flex align-items-center">
                                <img src="https://images.unsplash.com/photo-1602351447937-745c6bb00ad8?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" alt="Cupcake Matcha" class="rounded me-3 flex-shrink-0" style="width: 60px; height: 60px; object-fit: cover; background: #f8f8f8;">
                                <span class="fw-semibold text-success text-truncate" style="max-width: 120px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Cupcake Matcha</span>
                            </div>
                            <div class="col-2 text-success fw-bold text-end">40.000đ</div>
                            <div class="col-3 d-flex justify-content-center align-items-center">
                                <div class="input-group input-group-sm w-auto" style="vertical-align: middle; margin: 0;">
                                    <button class="btn btn-outline-success btn-sm decrease d-flex align-items-center justify-content-center" type="button" style="width: 32px; height: 32px; padding: 0;">-</button>
                                    <input type="text" class="form-control text-center quantity-input" value="2" min="1" readonly style="width: 40px; height: 32px; line-height: 32px; padding: 0;">
                                    <button class="btn btn-outline-success btn-sm increase d-flex align-items-center justify-content-center" type="button" style="width: 32px; height: 32px; padding: 0;">+</button>
                                </div>
                            </div>
                            <div class="col-2 d-flex justify-content-center">
                                <button class="btn btn-link text-danger remove-btn p-0" title="Xóa sản phẩm">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-white border-top-0 rounded-bottom">
                    <a href="@Url.Action("Index", "Home")" class="btn btn-link text-success ps-0">
                        <i class="fas fa-arrow-left me-2"></i> Tiếp tục mua sắm
                    </a>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card bg-light mb-4">
                <div class="card-body">
                    <h4 class="fw-bold text-success mb-4">Tóm tắt đơn hàng</h4>
                    <div class="mb-4">
                        <label for="promoCode" class="form-label fw-semibold">Mã giảm giá</label>
                        <div class="input-group">
                            <input type="text" id="promoCode" class="form-control" placeholder="Nhập mã giảm giá" style="height: 38px;">
                            <button type="button" class="btn btn-outline-success d-flex align-items-center justify-content-center" style="height: 38px; min-width: 80px;">Áp dụng</button>
                        </div>
                    </div>
                    <div class="border-top pt-3">
                        <ul class="list-group list-group-flush mb-3">
                            <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 py-2">
                                <span>Tiền hàng:</span>
                                <span class="subtotal-amount fw-semibold">155.000đ</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 py-2">
                                <span>Phí vận chuyển:</span>
                                <span class="shipping-fee">20.000đ</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 py-2 border-top">
                                <span class="fw-semibold">Tạm tính:</span>
                                <span class="cart-subtotal fw-semibold">175.000đ</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 py-2 border-top">
                                <span class="fw-bold text-success fs-5">Tổng cộng:</span>
                                <span class="cart-total fw-bold text-success fs-5">175.000đ</span>
                            </li>
                        </ul>
                    </div>
                    <a href="@Url.Action("Checkout", "Cart")" class="btn btn-success btn-lg w-100 mb-3 checkout-btn fw-bold">THANH TOÁN</a>
                    <div class="d-flex justify-content-center align-items-center gap-2">
                        <img src="https://cdn-icons-png.flaticon.com/512/196/196578.png" alt="Visa" style="width:28px; height:auto;">
                        <img src="https://cdn-icons-png.flaticon.com/512/196/196561.png" alt="MasterCard" style="width:28px; height:auto;">
                        <img src="https://cdn-icons-png.flaticon.com/512/196/196539.png" alt="PayPal" style="width:28px; height:auto;">
                        <img src="https://cdn-icons-png.flaticon.com/512/5968/5968299.png" alt="MoMo" style="width:28px; height:auto;">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Hiển thị khi giỏ hàng trống (ẩn đi nếu có sản phẩm trong giỏ) -->
    <div class="text-center py-5 empty-cart" style="display: none;">
        <i class="fas fa-shopping-cart fa-3x text-secondary mb-3"></i>
        <h3 class="mb-3">Giỏ hàng của bạn đang trống</h3>
        <p class="mb-4">Khám phá các sản phẩm tráng miệng tươi ngon của chúng tôi và thêm vào giỏ hàng để tiến hành đặt mua.</p>
        <a href="@Url.Action("Index", "Home")" class="btn btn-outline-success shop-now-btn">Mua sắm ngay</a>
    </div>
    <!-- Toast notifications container -->
    <div class="toast-container"></div>
</div>

@section scripts {
    <script>
        $(document).ready(function () {
            // Tăng số lượng sản phẩm
            $('.increase').click(function () {
                var input = $(this).siblings('.quantity-input');
                input.val(parseInt(input.val()) + 1);
                updateCartItem(input);
            });

            // Giảm số lượng sản phẩm
            $('.decrease').click(function () {
                var input = $(this).siblings('.quantity-input');
                var value = parseInt(input.val());
                if (value > 1) {
                    input.val(value - 1);
                    updateCartItem(input);
                }
            });

            // Cập nhật số lượng sản phẩm và tính lại tổng tiền
            function updateCartItem(input) {
                // Hiệu ứng cho biết đang cập nhật
                input.css('color', '#588157');
                setTimeout(function () {
                    input.css('color', '#3a5a40');
                }, 500);

                // Hiển thị thông báo
                showToast('<i class="fas fa-check-circle"></i> Giỏ hàng đã được cập nhật');

                // Tính lại tổng tiền
                calculateTotal();
            }

            // Hiển thị thông báo
            function showToast(message) {
                var toast = $('<div class="toast">' + message + '</div>');
                $('.toast-container').append(toast);

                setTimeout(function () {
                    toast.addClass('show');
                }, 100);

                setTimeout(function () {
                    toast.removeClass('show');
                    setTimeout(function () {
                        toast.remove();
                    }, 300);
                }, 2000);
            }

            // Tính tổng tiền
            function calculateTotal() {
                var subtotal = 0;

                // Tính tổng tiền hàng
                $('.list-group-item').each(function () {
                    var price = $(this).data('price');
                    var quantity = parseInt($(this).find('.quantity-input').val());
                    if (!isNaN(price) && !isNaN(quantity)) {
                        subtotal += price * quantity;
                    }
                });

                // Phí vận chuyển cố định
                var shipping = 20000;
                var total = subtotal + shipping;

                // Cập nhật hiển thị
                $('.subtotal-amount').text(formatCurrency(subtotal));
                $('.shipping-fee').text(formatCurrency(shipping));
                $('.cart-subtotal').text(formatCurrency(subtotal + shipping));
                $('.cart-total').text(formatCurrency(total));
            }

            // Định dạng tiền tệ VND
            function formatCurrency(amount) {
                return new Intl.NumberFormat('vi-VN', {
                    style: 'decimal',
                    maximumFractionDigits: 0
                }).format(amount) + 'đ';
            }

            // Xóa sản phẩm khỏi giỏ hàng
            $('.remove-btn').click(function () {
                if (confirm('Bạn có chắc chắn muốn xóa sản phẩm này?')) {
                    var item = $(this).closest('.list-group-item');
                    item.fadeOut(300, function () {
                        item.remove();

                        // Tính lại tổng tiền
                        calculateTotal();

                        // Hiển thị thông báo
                        showToast('<i class="fas fa-trash"></i> Đã xóa sản phẩm khỏi giỏ hàng');

                        // Kiểm tra nếu không còn sản phẩm nào
                        if ($('.list-group-item').length === 0) {
                            $('.row').hide();
                            $('.empty-cart').show();
                        }
                    });
                }
            });

            // Tính tổng tiền khi tải trang
            calculateTotal();
        });
    </script>
}

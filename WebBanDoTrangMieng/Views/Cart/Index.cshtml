@{
    ViewBag.Title = "Giỏ hàng";
}

<div class="cart-wrapper">
    <h1 class="cart-title">Giỏ hàng của bạn</h1>

    <!-- Trường hợp có sản phẩm trong giỏ hàng -->
    <div class="row">
        <div class="col-lg-8">
            <div class="cart-container">
                <div class="cart-header">
                    <div class="cart-header-row">
                        <div>Sản phẩm</div>
                        <div>Đơn giá</div>
                        <div>Số lượng</div>
                        <div></div>
                    </div>
                </div>
                <div class="cart-items">
                    <!-- Sản phẩm 1 -->
                    <div class="cart-item" data-id="1" data-price="75000">
                        <div class="product-col">
                            <img src="https://images.unsplash.com/photo-1587314168485-3236d6710814?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" alt="Bánh Mousse Matcha" class="product-image">
                            <div class="product-info">
                                <h4>Bánh Mousse Matcha</h4>
                                <div class="d-block d-md-none product-price">75.000đ</div>
                            </div>
                        </div>
                        <div class="product-price d-none d-md-block">75.000đ</div>
                        <div class="quantity-col">
                            <div class="quantity-wrapper">
                                <button class="quantity-btn decrease">-</button>
                                <input type="text" class="quantity-input" value="1" min="1" readonly>
                                <button class="quantity-btn increase">+</button>
                            </div>
                        </div>
                        <div>
                            <button class="remove-btn" title="Xóa sản phẩm">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Sản phẩm 2 -->
                    <div class="cart-item" data-id="2" data-price="40000">
                        <div class="product-col">
                            <img src="https://images.unsplash.com/photo-1602351447937-745c6bb00ad8?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" alt="Cupcake Matcha" class="product-image">
                            <div class="product-info">
                                <h4>Cupcake Matcha</h4>
                                <div class="d-block d-md-none product-price">40.000đ</div>
                            </div>
                        </div>
                        <div class="product-price d-none d-md-block">40.000đ</div>
                        <div class="quantity-col">
                            <div class="quantity-wrapper">
                                <button class="quantity-btn decrease">-</button>
                                <input type="text" class="quantity-input" value="2" min="1" readonly>
                                <button class="quantity-btn increase">+</button>
                            </div>
                        </div>
                        <div>
                            <button class="remove-btn" title="Xóa sản phẩm">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="cart-footer">
                    <a href="@Url.Action("Index", "Home")" class="continue-btn">
                        <i class="fas fa-arrow-left"></i> Tiếp tục mua sắm
                    </a>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="cart-summary">
                <h3 class="summary-title">Tóm tắt đơn hàng</h3>

                <div class="promo-form">
                    <label for="promoCode">Mã giảm giá</label>
                    <div class="promo-input">
                        <input type="text" id="promoCode" placeholder="Nhập mã giảm giá">
                        <button type="button">Áp dụng</button>
                    </div>
                </div>

                <div class="summary-row">
                    <span>Tiền hàng:</span>
                    <span class="subtotal-amount">155.000đ</span>
                </div>
                <div class="summary-row">
                    <span>Phí vận chuyển:</span>
                    <span class="shipping-fee">20.000đ</span>
                </div>
                <div class="summary-row subtotal">
                    <span>Tạm tính:</span>
                    <span class="cart-subtotal">175.000đ</span>
                </div>
                <div class="summary-row grand-total">
                    <span>Tổng cộng:</span>
                    <span class="cart-total">175.000đ</span>
                </div>

                <a href="@Url.Action("Checkout", "Cart")" class="btn checkout-btn">Thanh toán</a>

                <div class="payment-methods">
                    <img src="https://cdn-icons-png.flaticon.com/512/196/196578.png" alt="Visa">
                    <img src="https://cdn-icons-png.flaticon.com/512/196/196561.png" alt="MasterCard">
                    <img src="https://cdn-icons-png.flaticon.com/512/196/196539.png" alt="PayPal">
                    <img src="https://cdn-icons-png.flaticon.com/512/5968/5968299.png" alt="MoMo">
                </div>
            </div>
        </div>
    </div>

    <!-- Hiển thị khi giỏ hàng trống (ẩn đi nếu có sản phẩm trong giỏ) -->
    <div class="empty-cart" style="display: none;">
        <i class="fas fa-shopping-cart"></i>
        <h3>Giỏ hàng của bạn đang trống</h3>
        <p>Khám phá các sản phẩm tráng miệng tươi ngon của chúng tôi và thêm vào giỏ hàng để tiến hành đặt mua.</p>
        <a href="@Url.Action("Index", "Home")" class="shop-now-btn">Mua sắm ngay</a>
    </div>
</div>

<!-- Toast notifications container -->
<div class="toast-container"></div>

@section scripts {
    <script>
        $(document).ready(function () {
            // Tăng số lượng sản phẩm
            $('.increase').click(function () {
                var input = $(this).siblings('.quantity-input');
                input.val(parseInt(input.val()) + 1);
                updateCartItem(input);
            });

            // Giảm số lượng sản phẩm
            $('.decrease').click(function () {
                var input = $(this).siblings('.quantity-input');
                var value = parseInt(input.val());
                if (value > 1) {
                    input.val(value - 1);
                    updateCartItem(input);
                }
            });

            // Cập nhật số lượng sản phẩm và tính lại tổng tiền
            function updateCartItem(input) {
                // Hiệu ứng cho biết đang cập nhật
                input.css('color', '#588157');
                setTimeout(function () {
                    input.css('color', '#3a5a40');
                }, 500);

                // Hiển thị thông báo
                showToast('<i class="fas fa-check-circle"></i> Giỏ hàng đã được cập nhật');

                // Tính lại tổng tiền
                calculateTotal();
            }

            // Hiển thị thông báo
            function showToast(message) {
                var toast = $('<div class="toast">' + message + '</div>');
                $('.toast-container').append(toast);

                setTimeout(function () {
                    toast.addClass('show');
                }, 100);

                setTimeout(function () {
                    toast.removeClass('show');
                    setTimeout(function () {
                        toast.remove();
                    }, 300);
                }, 2000);
            }

            // Tính tổng tiền
            function calculateTotal() {
                var subtotal = 0;

                // Tính tổng tiền hàng
                $('.cart-item').each(function () {
                    var price = $(this).data('price');
                    var quantity = parseInt($(this).find('.quantity-input').val());
                    subtotal += price * quantity;
                });

                // Phí vận chuyển cố định
                var shipping = 20000;
                var total = subtotal + shipping;

                // Cập nhật hiển thị
                $('.subtotal-amount').text(formatCurrency(subtotal));
                $('.shipping-fee').text(formatCurrency(shipping));
                $('.cart-subtotal').text(formatCurrency(subtotal + shipping));
                $('.cart-total').text(formatCurrency(total));
            }

            // Định dạng tiền tệ VND
            function formatCurrency(amount) {
                return new Intl.NumberFormat('vi-VN', {
                    style: 'decimal',
                    maximumFractionDigits: 0
                }).format(amount) + 'đ';
            }

            // Xóa sản phẩm khỏi giỏ hàng
            $('.remove-btn').click(function () {
                if (confirm('Bạn có chắc chắn muốn xóa sản phẩm này?')) {
                    var item = $(this).closest('.cart-item');
                    item.fadeOut(300, function () {
                        item.remove();

                        // Tính lại tổng tiền
                        calculateTotal();

                        // Hiển thị thông báo
                        showToast('<i class="fas fa-trash"></i> Đã xóa sản phẩm khỏi giỏ hàng');

                        // Kiểm tra nếu không còn sản phẩm nào
                        if ($('.cart-item').length === 0) {
                            $('.row').hide();
                            $('.empty-cart').show();
                        }
                    });
                }
            });

            // Tính tổng tiền khi tải trang
            calculateTotal();
        });
    </script>
}
